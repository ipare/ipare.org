import{_ as r,o as t,c as s,a as e,b as a,e as i,d as n,r as o}from"./app.a704fd29.js";const l={},c=e("h1",{id:"jwt-\u8EAB\u4EFD\u9A8C\u8BC1",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#jwt-\u8EAB\u4EFD\u9A8C\u8BC1","aria-hidden":"true"},"#"),i(" Jwt \u8EAB\u4EFD\u9A8C\u8BC1")],-1),u=e("p",null,[i("\u5B89\u88C5 "),e("code",null,"@ipare/jwt"),i(" \u4EE5\u4F7F\u7528 Jwt \u8EAB\u4EFD\u9A8C\u8BC1")],-1),h=e("p",null,[e("code",null,"@ipare/jwt"),i(" \u57FA\u4E8E\u4EE5\u4E0B\u5185\u5BB9")],-1),p={href:"https://github.com/auth0/node-jsonwebtoken",target:"_blank",rel:"noopener noreferrer"},v=i("jsonwebtoken"),b={href:"https://github.com/ipare/inject",target:"_blank",rel:"noopener noreferrer"},m=i("@ipare/inject"),w=n(`<h2 id="\u5FEB\u901F\u5F00\u59CB" tabindex="-1"><a class="header-anchor" href="#\u5FEB\u901F\u5F00\u59CB" aria-hidden="true">#</a> \u5FEB\u901F\u5F00\u59CB</h2><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>import &quot;@ipare/jwt&quot;;
startup.useJwt(options);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>import &quot;@ipare/jwt&quot;;
import { TestStartup } from &quot;@ipare/core&quot;;

const res = await new TestStartup()
  .useJwt(options)
  .useJwtVerify()
  .run()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h2><p><code>useJwt</code> \u63A5\u6536\u4E00\u4E2A\u914D\u7F6E\u53C2\u6570\uFF0C\u5305\u62EC\u4EE5\u4E0B\u914D\u7F6E</p><h3 id="secret" tabindex="-1"><a class="header-anchor" href="#secret" aria-hidden="true">#</a> secret</h3><p>jwt \u5BC6\u94A5</p><h3 id="publickey-privatekey" tabindex="-1"><a class="header-anchor" href="#publickey-privatekey" aria-hidden="true">#</a> publicKey &amp; privateKey</h3><p>jwt \u516C\u94A5\u548C\u79C1\u94A5</p><p>RSA \u548C ECDSA \u52A0\u5BC6\u7684 PEM \u516C\u94A5</p><h3 id="signoptions-verifyoptions" tabindex="-1"><a class="header-anchor" href="#signoptions-verifyoptions" aria-hidden="true">#</a> signOptions &amp; verifyOptions</h3><p>\u521B\u5EFA <code>jwt token</code> \u548C\u9A8C\u8BC1 <code>jwt token</code> \u662F\u7684\u914D\u7F6E\u53C2\u6570</p>`,12),j=i("\u5177\u4F53\u914D\u7F6E\u53C2\u8003 "),g={href:"https://github.com/auth0/node-jsonwebtoken",target:"_blank",rel:"noopener noreferrer"},f=i("jsonwebtoken"),x=n(`<h3 id="prefix" tabindex="-1"><a class="header-anchor" href="#prefix" aria-hidden="true">#</a> <code>prefix</code></h3><p><code>jwt token</code> \u7684\u524D\u7F00\uFF0C\u7528\u4E8E\u89E3\u6790\uFF0C\u9ED8\u8BA4\u4E3A <code>Bearer</code></p><h3 id="gettoken" tabindex="-1"><a class="header-anchor" href="#gettoken" aria-hidden="true">#</a> getToken</h3><p><code>getToken</code> \u662F\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u6307\u793A <code>jwt token</code> \u7684\u4F4D\u7F6E\uFF0C\u5982 <code>headers</code>/<code>query</code> \u4E2D</p><p>\u4F7F\u7528 <code>useJwt</code> \u540E\u4F1A\u7ED9 <code>HttpContext</code> \u5BF9\u8C61\u589E\u52A0 <code>jwtToken</code> \u5C5E\u6027\uFF0C\u9ED8\u8BA4\u53D6\u81EA\u8BF7\u6C42\u5934\u90E8 <code>Authorization</code> \u503C</p><p>\u8BBE\u7F6E <code>getToken</code> \u540E\u53EF\u4EE5\u4ECE\u5176\u4ED6\u4F4D\u7F6E\u83B7\u53D6 <code>jwt token</code></p><h2 id="\u5185\u7F6E\u9A8C\u8BC1-jwt" tabindex="-1"><a class="header-anchor" href="#\u5185\u7F6E\u9A8C\u8BC1-jwt" aria-hidden="true">#</a> \u5185\u7F6E\u9A8C\u8BC1 jwt</h2><p><code>startup.useJwtVerify()</code> \u53EF\u4EE5\u6DFB\u52A0\u5BF9 jwt token \u7684\u9A8C\u8BC1</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>startup
  .useJwt()
  .useJwtVerify()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u51FD\u6570\u63A5\u6536\u4E24\u4E2A\u53C2\u6570</p><ul><li>skip: \u56DE\u8C03\u51FD\u6570\uFF0C\u8FD4\u56DE <code>Promise&lt;bool&gt;</code><ul><li>\u5982\u679C\u503C\u4E3A true\uFF0C\u5219\u4E0D\u6821\u9A8C\u6B64\u6B21\u8BF7\u6C42</li><li>\u5982\u679C\u503C\u4E3A false\uFF0C\u5219\u6821\u9A8C\u6B64\u6B21\u8BF7\u6C42\u7684 <code>jwt token</code> \u662F\u5426\u6B63\u786E</li></ul></li><li>onError: \u53EF\u9009\u53C2\u6570\uFF0C\u56DE\u8C03\u51FD\u6570\uFF0C\u9A8C\u8BC1 jwt \u5931\u8D25\u65F6\u4F1A\u8C03\u7528 <ul><li>\u5982\u679C\u4E0D\u4F20\u6B64\u53C2\u6570\u5C06\u4F7F\u7528\u9ED8\u8BA4\u903B\u8F91\u8FD4\u56DE 401</li><li>\u56DE\u8C03\u51FD\u6570\u6709\u4E24\u4E2A\u53C2\u6570\uFF1AHttpContext \u548C\u9519\u8BEF\u4FE1\u606F</li></ul></li></ul><h2 id="\u989D\u5916\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#\u989D\u5916\u9A8C\u8BC1" aria-hidden="true">#</a> \u989D\u5916\u9A8C\u8BC1</h2><p>\u5982\u679C\u53EA\u9A8C\u8BC1 token \u5E76\u4E0D\u6EE1\u8DB3\u9700\u6C42\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>startup.useJwtExtraAuth</code> \u6DFB\u52A0\u989D\u5916\u7684\u9A8C\u8BC1</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>startup
  .useJwt()
  .useJwtVerify()
  .useJwtExtraAuth((ctx)=&gt;bool)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u51FD\u6570\u63A5\u6536\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570\uFF0C\u8FD4\u56DE <code>Promise&lt;bool&gt;</code></p><ul><li>\u5982\u679C\u8FD4\u56DE\u503C\u4E3A true\uFF0C\u8BF4\u660E\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u4F1A\u7EE7\u7EED\u6267\u884C\u4E0B\u4E00\u4E2A\u4E2D\u95F4\u4EF6</li><li>\u5982\u679C\u8FD4\u56DE\u503C\u4E3A false\uFF0C\u8BF4\u660E\u9A8C\u8BC1\u5931\u8D25\uFF0C\u5C06\u7EC8\u6B62\u540E\u7EED\u4E2D\u95F4\u4EF6\u6267\u884C</li></ul><p>\u5982\u679C\u56DE\u8C03\u51FD\u6570\u8FD4\u56DE false\uFF0C\u5E76\u4E14\u6CA1\u6709\u8BBE\u7F6E\u72B6\u6001\u7801\uFF08\u5373 <code>404</code>\uFF09\uFF0C\u4E5F\u6CA1\u6709\u8BBE\u7F6E <code>body</code>(<code>undefined</code>)\uFF0C\u72B6\u6001\u7801\u4F1A\u88AB\u81EA\u52A8\u8BBE\u7F6E\u4E3A <code>401</code></p><h2 id="jwtservice" tabindex="-1"><a class="header-anchor" href="#jwtservice" aria-hidden="true">#</a> JwtService</h2><p>JwtService \u63D0\u4F9B\u4E86\u4E00\u4E9B jwt \u65B9\u6CD5</p><p>\u5728\u8C03\u7528 <code>useJwt</code> \u65F6\u5C31\u5DF2\u7ECF\u4F7F\u7528 <code>@ipare/inject</code> \u6CE8\u5165\u4E86 <code>JwtService</code></p><h3 id="\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#\u5F15\u7528" aria-hidden="true">#</a> \u5F15\u7528</h3><p>\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>\u4F9D\u8D56\u6CE8\u5165/\u63A7\u5236\u53CD\u8F6C</code> \u7684\u65B9\u5F0F\u4F7F\u7528 <code>JwtService</code></p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>class YourMiddleware extends Middleware{
  @Inject
  private readonly jwtService!:JwtService;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OR</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>@Inject
class YourMiddleware extends Middleware{
  constructor(private readonly jwtService:JwtService){}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OR</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>const jwtService = await parseInject(ctx, JwtService);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u63D0\u4F9B\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u63D0\u4F9B\u65B9\u6CD5" aria-hidden="true">#</a> \u63D0\u4F9B\u65B9\u6CD5</h3><h4 id="sign" tabindex="-1"><a class="header-anchor" href="#sign" aria-hidden="true">#</a> sign</h4><p>\u751F\u6210 jwt token</p><p>\u63A5\u6536\u4E24\u4E2A\u53C2\u6570</p><ul><li>payload: jwt payload</li><li>options: jwt \u914D\u7F6E\uFF0C\u53EF\u9009\u53C2\u6570\u3002\u4F18\u5148\u4F7F\u7528\u8FD9\u4E2A\u914D\u7F6E\uFF0C\u6CA1\u6709\u7684\u914D\u7F6E\u9879\u518D\u4F7F\u7528 <code>useJwt</code> \u4F20\u5165\u7684\u914D\u7F6E</li></ul><h4 id="verify" tabindex="-1"><a class="header-anchor" href="#verify" aria-hidden="true">#</a> verify</h4><p>\u9A8C\u8BC1 jwt token</p><p>\u5982\u679C\u9A8C\u8BC1\u5931\u8D25\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0C\u8BF7\u4F7F\u7528 <code>try{}catch{}</code> \u6216 <code>Promise.catch</code></p><p>\u63A5\u6536\u4E24\u4E2A\u53C2\u6570</p><ul><li>token: jwt token</li><li>options: jwt \u914D\u7F6E\uFF0C\u53EF\u9009\u53C2\u6570\u3002\u4F18\u5148\u4F7F\u7528\u8FD9\u4E2A\u914D\u7F6E\uFF0C\u6CA1\u6709\u7684\u914D\u7F6E\u9879\u518D\u4F7F\u7528 <code>useJwt</code> \u4F20\u5165\u7684\u914D\u7F6E</li></ul><h4 id="decode" tabindex="-1"><a class="header-anchor" href="#decode" aria-hidden="true">#</a> decode</h4><p>\u89E3\u6790 jwt token</p><p>\u5982\u679C\u89E3\u6790\u5931\u8D25\u8FD4\u56DE null\uFF0C\u89E3\u6790\u6210\u529F\u8FD4\u56DE\u7ED3\u679C\u53D6\u51B3\u4E8E\u4F20\u5165\u53C2\u6570\uFF0C\u5177\u4F53\u67E5\u770B ts \u667A\u80FD\u63D0\u793A</p><p>\u63A5\u6536\u4E24\u4E2A\u53C2\u6570</p><ul><li>token: jwt token</li><li>options: jwt \u914D\u7F6E\uFF0C\u53EF\u9009\u53C2\u6570\u3002\u4F18\u5148\u4F7F\u7528\u8FD9\u4E2A\u914D\u7F6E\uFF0C\u6CA1\u6709\u7684\u914D\u7F6E\u9879\u518D\u4F7F\u7528 <code>useJwt</code> \u4F20\u5165\u7684\u914D\u7F6E</li></ul><h2 id="\u88C5\u9970\u5668" tabindex="-1"><a class="header-anchor" href="#\u88C5\u9970\u5668" aria-hidden="true">#</a> \u88C5\u9970\u5668</h2><p>\u4F60\u53EF\u4EE5\u5728\u4F7F\u7528\u88C5\u9970\u5668\u6765\u5FEB\u6377\u4F7F\u7528\u548C\u89E3\u6790 <code>jwt token</code></p><h3 id="\u5728\u4E2D\u95F4\u4EF6\u4E2D" tabindex="-1"><a class="header-anchor" href="#\u5728\u4E2D\u95F4\u4EF6\u4E2D" aria-hidden="true">#</a> \u5728\u4E2D\u95F4\u4EF6\u4E2D</h3><p>\u5728\u4E2D\u95F4\u4EF6\u4E2D\u7684\u88C5\u9970\u5668\u4F1A\u88AB\u81EA\u52A8\u89E3\u6790</p><h4 id="jwttoken" tabindex="-1"><a class="header-anchor" href="#jwttoken" aria-hidden="true">#</a> @JwtToken</h4><p><code>jwt token</code> \u5B57\u7B26\u4E32</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>import { Middleware } from &quot;@ipare/core&quot;;
import * as jwt from &quot;jsonwebtoken&quot;;

class TestMiddleware extends Middleware{
  @JwtToken
  private readonly token!: string;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jwtobject" tabindex="-1"><a class="header-anchor" href="#jwtobject" aria-hidden="true">#</a> @JwtObject</h4><p>\u89E3\u6790 <code>jwt token</code> \u5B57\u7B26\u4E32\u5E76\u8F6C\u4E3A json \u5BF9\u8C61</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>import { Middleware } from &quot;@ipare/core&quot;;
import * as jwt from &quot;jsonwebtoken&quot;;

class TestMiddleware extends Middleware{
  @JwtObject
  private readonly jwt!: jwt.Jwt;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jwtpayload" tabindex="-1"><a class="header-anchor" href="#jwtpayload" aria-hidden="true">#</a> @JwtPayload</h4><p>\u53EA\u53D6 jwt payload \u90E8\u5206\uFF0C\u5982\u679C\u662F json \u5B57\u7B26\u4E32\uFF0C\u5219\u4F1A\u81EA\u52A8\u89E3\u6790</p><div class="language-TS ext-TS line-numbers-mode"><pre class="language-TS"><code>import { Middleware } from &quot;@ipare/core&quot;;
import * as jwt from &quot;jsonwebtoken&quot;;

class TestMiddleware extends Middleware{
  @JwtPayload
  private readonly payload!: any;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,55);function k(S,T){const d=o("ExternalLinkIcon");return t(),s("div",null,[c,u,h,e("ul",null,[e("li",null,[e("a",p,[v,a(d)])]),e("li",null,[e("a",b,[m,a(d)])])]),w,e("p",null,[j,e("a",g,[f,a(d)])]),x])}var y=r(l,[["render",k],["__file","jwt.html.vue"]]);export{y as default};
